---
title: "KaggleRevised11_30_25"
author: "Brandon Kim"
date: "2025-11-30"
output: html_document
---
```{r}
library(caret)

set.seed(101)
```

```{r}

Mode <- function(x) {
  x <- x[!is.na(x)]
  if (!length(x)) return(NA)
  ux <- unique(x)
  ux[which.max(tabulate(match(x, ux)))]
}

# 1 read data


skin_tr <- read.csv("SkinCancerTrain (5).csv", check.names = TRUE)
skin_te <- read.csv("SkinCancerTestNoY.csv",  check.names = TRUE)

# 2 manually drop irrelevant predictors

drop_cols <- c(
  "alcohol_drinks_per_week",
  "zip_code_last_digit",
  "desk_height_cm",
  "monthly_screen_time_minutes",
  "years_lived_at_address",
  "near_high_power_cables",
  "pets",
  "income",
  "music_genre",
  "favorite_color",
  "phone_brand",
  "favorite_cuisine",
  "uses_smartwatch",
  "preferred_shoe_type",
  "BMI",
  "education",
  "access_to_nude_beach",
  "sunscreen_type",
  "sunscreen_brand",
  "occupation",
  "exercise_freq_per_week"
)


keep_tr <- setdiff(names(skin_tr), drop_cols)
keep_te <- setdiff(names(skin_te), drop_cols)

skin_tr <- skin_tr[, keep_tr, drop = FALSE]
skin_te <- skin_te[, keep_te, drop = FALSE]

# 3 basic setup after dropping

id_tr <- names(skin_tr)[1]
id_te <- names(skin_te)[1]

skin_tr$Cancer <- factor(skin_tr$Cancer)

# numeric vs categorical predictors
num_cols <- setdiff(
  names(skin_tr)[sapply(skin_tr, is.numeric)],
  c(id_tr, "Cancer")
)

cat_cols <- setdiff(
  names(skin_tr),
  c(num_cols, id_tr, "Cancer")
)

# print the remaining predictors clearly before modeling
cat("Numeric predictors (", length(num_cols), "):\n", sep = "")
cat(paste(num_cols, collapse = ", "), "\n\n")

cat("Categorical predictors (", length(cat_cols), "):\n", sep = "")
cat(paste(cat_cols, collapse = ", "), "\n\n")










# 4 imputation using median and mode

tr_imp <- skin_tr
te_imp <- skin_te

# numeric - median from train
for (nm in num_cols) {
  m <- median(tr_imp[[nm]], na.rm = TRUE)
  tr_imp[[nm]][is.na(tr_imp[[nm]])] <- m
  te_imp[[nm]][is.na(te_imp[[nm]])] <- m
}

# categorical - mode from train, align levels
for (nm in cat_cols) {
  tr_imp[[nm]] <- as.character(tr_imp[[nm]])
  te_imp[[nm]] <- as.character(te_imp[[nm]])

  md <- Mode(tr_imp[[nm]])
  tr_imp[[nm]][is.na(tr_imp[[nm]])] <- md
  te_imp[[nm]][is.na(te_imp[[nm]])] <- md

  lv <- union(unique(tr_imp[[nm]]), unique(te_imp[[nm]]))
  tr_imp[[nm]] <- factor(tr_imp[[nm]], levels = lv)
  te_imp[[nm]] <- factor(te_imp[[nm]], levels = lv)
}

cat("Remaining NAs, Train:", sum(is.na(tr_imp)), "\n")
cat("Remaining NAs, Test :", sum(is.na(te_imp)), "\n\n")

# 5 build modeling matrices

Xtr_raw <- tr_imp[, !(names(tr_imp) %in% c(id_tr, "Cancer")), drop = FALSE]
ytr     <- tr_imp$Cancer
Xte_raw <- te_imp[, !(names(te_imp) %in% c(id_te)), drop = FALSE]

# 6 dummy encode categoricals and scale predictors

dmy <- dummyVars(~ ., data = Xtr_raw, fullRank = TRUE)

Xtr <- as.data.frame(predict(dmy, Xtr_raw))
Xte <- as.data.frame(predict(dmy, Xte_raw))

pp  <- preProcess(Xtr, method = c("center", "scale"))
Xtr <- predict(pp, Xtr)
Xte <- predict(pp, Xte)

# 7 train logistic regression with 5 fold CV

ctrl <- trainControl(
  method = "cv",
  number = 5
)

fit_glm <- train(
  x = Xtr,
  y = ytr,
  method  = "glm",
  family  = binomial(),
  trControl = ctrl,
  metric = "Accuracy"
)

print(fit_glm$results)

# 8 predict on test set and create submission

test_pred <- predict(fit_glm, Xte)

submission <- data.frame(
  ID     = te_imp[[id_te]],
  Cancer = test_pred,
  check.names = FALSE
)

stopifnot(
  ncol(submission) == 2,
  all(names(submission) == c("ID", "Cancer")),
  nrow(submission) == nrow(te_imp)
)

out_name <- "skin_cancer_filtered.csv"
write.csv(submission, out_name, row.names = FALSE)

cat("The file is located in:\n", normalizePath(out_name), "\n")


```

